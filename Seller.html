<!DOCTYPE html>
<html>
<head>
  <title>Delight.pk Seller Panel</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f9;
      margin: 0;
      padding: 0;
    }

    header {
      background: #ef6c00;
      color: white;
      text-align: center;
      padding: 18px;
      font-size: 22px;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .container {
      max-width: 700px;
      margin: 30px auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
    }

    h3 {
      color: #ef6c00;
      border-bottom: 2px solid #ef6c00;
      padding-bottom: 6px;
      margin-bottom: 15px;
      font-size: 20px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 5px;
      font-size: 15px;
    }

    input[type="file"] {
      margin-top: 8px;
    }

    button {
      background: #ef6c00;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
      margin-right: 10px;
      font-size: 15px;
      transition: 0.3s;
    }

    button:hover {
      background: #d85c00;
    }

    pre {
      background: #f9f9f9;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 10px;
      white-space: pre-wrap;
      word-break: break-word;
      margin-top: 20px;
      font-size: 14px;
    }

    #copyBtn {
      display: none;
    }

    .preview-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .preview-container img, 
    .preview-container video {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    /* File input style */
input[type="file"] {
  display: block;
  font-size: 14px;
  color: #444;
  margin-top: 8px;
}

input[type="file"]::file-selector-button {
  background: #ef6c00;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: 0.3s;
}

input[type="file"]::file-selector-button:hover {
  background: #d85c00;
}
  </style>
</head>
<body>

<header>Delight.pk Seller Panel</header>

<div class="container">
  <h3>Add New Product</h3>

  <label>Title:</label>
  <input type="text" id="title" placeholder="Will auto-fill from *Product Name*">

  <label>Price:</label>
  <input type="text" id="price" placeholder="Example: 990">

  <label>Description:</label>
  <textarea id="description" rows="8" placeholder="*Product Name*: Stylish Smart Watch - 1 Pcs&#10;*Product Description*: Elegant design&#10;Color: Red, Blue&#10;Sizes: Medium, Large&#10;MZ53500000018HHK"></textarea>

  <label>Select JPG Images (1st one is main image):</label>
  <div id="imageInputs">
    <input type="file" accept="image/*" class="imgInput"><br>
    <input type="file" accept="image/*" class="imgInput"><br>
    <input type="file" accept="image/*" class="imgInput"><br>
    <input type="file" accept="image/*" class="imgInput"><br>
    <input type="file" accept="image/*" class="imgInput"><br>
    <input type="file" accept="image/*" class="imgInput"><br>
    <input type="file" accept="image/*" class="imgInput"><br>
    <input type="file" accept="image/*" class="imgInput"><br>
  </div>
  <div id="imagePreview" class="preview-container"></div>

  <label>Select MP4 Videos (optional):</label>
  <div id="videoInputs">
    <input type="file" accept="video/mp4" class="videoInput"><br>
    <input type="file" accept="video/mp4" class="videoInput"><br>
    <input type="file" accept="video/mp4" class="videoInput"><br>
    <input type="file" accept="video/mp4" class="videoInput"><br>
  </div>
  <div id="videoPreview" class="preview-container"></div>

  <small style="color:gray;">If video doesn't appear, open ‘Files’ and choose manually.</small><br>

  <button onclick="generateItem()">Generate itemData</button>
  <button id="copyBtn" onclick="copyToClipboard()">Copy</button>

  <pre id="resultBox"></pre>
</div>

<script>
function formatDescription(rawText) {
  const lines = rawText.split("\n").map(line => line.trim()).filter(line => line !== "");
  let productCodeLine = "";
  const descriptionLines = [];

  for (let line of lines) {
    if (/MZ\d{5,}/i.test(line) || line.toLowerCase().includes("product code")) {
      const updatedLine = line.replace(/MZ/gi, "DP");
      productCodeLine = `<li><strong>${updatedLine}</strong></li>\n`;
    } else if (line.toLowerCase().startsWith("*product name*:")) {
      continue;
    } else {
      descriptionLines.push(line);
    }
  }

  let result = "<ul>\n";
  if (productCodeLine) {
    result += `  ${productCodeLine}`;
  }

  for (let line of descriptionLines) {
    if (line.toLowerCase().startsWith("*product description") && line.includes("*:")) {
      const content = line.replace(/\*product description\*:/i, "").trim();
      result += `  <li><strong>Product Description</strong>: ${content}</li>\n`;
    } else {
      result += `  <li>${line}</li>\n`;
    }
  }

  result += "</ul>";
  return result;
}

// ✅ Preview Images
document.querySelectorAll(".imgInput").forEach(input => {
  input.addEventListener("change", function() {
    const previewContainer = document.getElementById("imagePreview");
    previewContainer.innerHTML = "";
    document.querySelectorAll(".imgInput").forEach(inp => {
      if (inp.files[0]) {
        const img = document.createElement("img");
        img.src = URL.createObjectURL(inp.files[0]);
        previewContainer.appendChild(img);
      }
    });
  });
});

// ✅ Preview Videos
document.querySelectorAll(".videoInput").forEach(input => {
  input.addEventListener("change", function() {
    const previewContainer = document.getElementById("videoPreview");
    previewContainer.innerHTML = "";
    document.querySelectorAll(".videoInput").forEach(inp => {
      if (inp.files[0]) {
        const vid = document.createElement("video");
        vid.src = URL.createObjectURL(inp.files[0]);
        vid.controls = true;
        previewContainer.appendChild(vid);
      }
    });
  });
});

function generateItem() {
  const rawDescription = document.getElementById("description").value;
  const titleInput = document.getElementById("title");
  const priceInput = document.getElementById("price");
  const imgInputs = document.querySelectorAll(".imgInput");
  const videoInputs = document.querySelectorAll(".videoInput");
  const resultBox = document.getElementById("resultBox");
  const copyBtn = document.getElementById("copyBtn");

  let autoTitle = "";
  rawDescription.split("\n").forEach(line => {
    if (line.toLowerCase().startsWith("*product name*:")) {
      autoTitle = line.split(":")[1]?.trim() || "";
    }
  });
  if (autoTitle) titleInput.value = autoTitle;

  const title = titleInput.value.trim();
  let price = priceInput.value.trim();
  const formattedDescription = formatDescription(rawDescription);

  let fileNames = [];
  imgInputs.forEach(input => {
    const file = input.files[0];
    if (file && file.name.toLowerCase().endsWith(".jpg")) {
      fileNames.push(`"${file.name}"`);
    }
  });

  videoInputs.forEach(input => {
    const file = input.files[0];
    if (file && file.name.toLowerCase().endsWith(".mp4")) {
      fileNames.push(`"${file.name}"`);
    }
  });

  if (!title || !price || fileNames.length === 0 || !rawDescription.trim()) {
    resultBox.textContent = "⚠️ Please fill all fields and select at least one image. Also include *Product Name* in description.";
    copyBtn.style.display = "none";
    return;
  }

  if (!price.toLowerCase().includes("rs.")) {
    price = "Rs." + price.replace(/^Rs\s*/i, "");
  } else {
    price = price.replace(/\s+/g, "");
  }

  const mainImage = fileNames[0];

  let colors = [];
  rawDescription.split("\n").forEach(line => {
    const lower = line.toLowerCase();
    if (lower.startsWith("color:") || lower.startsWith("colors:") || lower.startsWith("size:") || lower.startsWith("sizes:")) {
      const parts = line.split(":")[1];
      if (parts) {
        const items = parts.split(",").map(c => `"${c.trim()}"`);
        colors.push(...items);
      }
    }
  });

  const output = `{
  title: "${title}",
  price: "${price}",
  image: ${mainImage},
  media: [
    ${fileNames.join(",\n    ")}
  ],
  colors: [${colors.join(", ")}],
  description: \`
${formattedDescription}
\`
},`;

  resultBox.textContent = output;
  copyBtn.style.display = "inline-block";
}

function copyToClipboard() {
  const text = document.getElementById("resultBox").textContent;
  navigator.clipboard.writeText(text).then(() => {
    alert("✅ Copied to clipboard!");
  }).catch(err => {
    alert("❌ Copy failed.");
  });
}
</script>

</body>
</html>